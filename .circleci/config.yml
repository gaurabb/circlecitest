version: 2
jobs:
   test:
     docker:
       - image: circleci/ruby:2.3.4
     steps:
       - checkout
       - run:
          name: Install Dawnscanner
          command: 'gem install dawnscanner'
       - run:
          name: Run Dawnscanner
          command: 'dawn railsgoat/'
       - store_test_results:
          path: test/reports/code_vulnerabilities.txt
          destination: code_vulnerabilities.txt
       - run:
          name: Display scan summary
          command: 'sudo cat /home/circleci/dawnscanner/results/railsgoat/*/summary.txt'
       - run:
          name: Display scan details
          command: 'sudo cat /home/circleci/dawnscanner/results/railsgoat/*/statistics.txt'
       - run:
          name: Check if there are vulnerabilities
          command: 'test -f /home/circleci/dawnscanner/results/railsgoat/*/third_party_vulnerabilities.txt && echo "There are vulnerabilities in your code. Please review the results." || echo "No vulnerabilities detected. Good job!" '
workflows:
 version: 2
 build_and_test:
  jobs:
    - test 